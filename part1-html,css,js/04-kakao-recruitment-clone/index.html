<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./index.css" />
    <title>Fast Bank</title>
  </head>
  <body>
    <div id="main-img-wrapper">
      <img width="320" src="./Lovepik_com-401339128-data-management-data-analysis-icon-free-vector-illustration-mate.png" alt="coding image" />
    </div>
    <div id="intro-main">
      <p>이미 모두의 은행, 패스트뱅크</p>
      <p>함께 일해요</p>
      <p id="join-us-text">join us!</p>
      <img id="down-arrow-icon" src="./down-arrow.png" alt="down arrow icon" />
    </div>
    <ul id="list-item-wrapper">
      <li class="list-item">26주적금</li>
      <li class="list-item">저금</li>
      <li class="list-item">패스트캠퍼스</li>
      <li class="list-item">떡볶이</li>
      <li class="list-item">치킨</li>
      <li class="list-item">축구</li>
      <li class="list-item">축구선수</li>
      <li class="list-item">마이너스통장대출</li>
      <li class="list-item">26주적금</li>
      <li class="list-item">저금</li>
      <li class="list-item">패스트캠퍼스</li>
      <li class="list-item">떡볶이</li>
      <li class="list-item">치킨</li>
      <li class="list-item">축구</li>
      <li class="list-item">축구선수</li>
      <li class="list-item">마이너스통장대출</li>
      <li class="list-item">26주적금</li>
      <li class="list-item">저금</li>
      <li class="list-item">패스트캠퍼스</li>
      <li class="list-item">떡볶이</li>
      <li class="list-item">치킨</li>
      <li class="list-item">축구</li>
      <li class="list-item">축구선수</li>
      <li class="list-item">마이너스통장대출</li>
      <li class="list-item">26주적금</li>
      <li class="list-item">저금</li>
      <li class="list-item">패스트캠퍼스</li>
      <li class="list-item">떡볶이</li>
      <li class="list-item">치킨</li>
      <li class="list-item">축구</li>
      <li class="list-item">축구선수</li>
      <li class="list-item">마이너스통장대출</li>
    </ul>
    <main>
      <section id="panel1-img">
        <img id="flying-santa-image" src="./santa_flying.png" alt="santa flying" />
      </section>
      <section id="video-section">
        <div id="fixed-wrapper">
          <video id="video" src="http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4" type="video/mp4" muted loop></video>
          <div id="fixed-description">
            <div>혁신이 만든</div>
            <div>압도적인 성장</div>
          </div>
        </div>
      </section>
    </main>
  </body>
  <script>
    const listStyleChangeStartY = 373;
    const listStyleChangeEndY = 1585;

    const listItems = document.querySelectorAll(".list-item");

    // 지정한 스크롤 안에서 바뀌어야하는 배열의 요소 수 만큼 나누어지는 수를 변수에 할당
    const division = (listStyleChangeEndY - listStyleChangeStartY) / listItems.length;

    const panel1Img = document.getElementById("panel1-img");
    const flyingSantaImage = document.getElementById("flying-santa-image");

    // 스크롤 양에 따른 비디오 재생 위치를 제어하는 변수
    // 값⬆️ == 비디오재생속도⬇️, 스크롤양⬆️
    // 값⬇️ == 비디오재생속도⬆️, 스크롤양⬇
    const videoPlayBack = 500;

    const videoElement = document.getElementById("video");
    const videoSection = document.getElementById("video-section");

    const fixedWrapper = document.getElementById("fixed-wrapper");

    const fixedDescription = document.getElementById("fixed-description");

    function centerElement(elementId, video) {
      const element = document.getElementById(elementId);
      const parent = element.parentElement;

      // 지정한 요소(fixed-wrapper)가 현재 뷰포트의 중앙에 있는지 확인하는 로직
      // if문이 실행되면 해당 요소를 화면 가운데에 고정
      // 원하는 조건에서 벗어나면 원래대로 초기화
      if (window.scrollY > parent.offsetTop - (document.documentElement.clientHeight - element.offsetHeight) / 2) {
        element.style.position = "fixed";
        element.style.top = "50%";
        element.style.left = "50%";
        element.style.transform = "translate(-50%, -50%)";
        if (video) {
          video.currentTime = (window.scrollY - videoSection.offsetTop) / videoPlayBack;
        }
      } else {
        element.style.position = "relative";
        element.style.top = "initial";
        element.style.left = "initial";
        element.style.transform = "initial";
      }
    }

    // 비디오의 길이와 임의로 지정한 videoPlayBack을 합쳐 video-section의 높이를 조절
    videoElement.addEventListener("loadedmetadata", () => {
      document.getElementById("video-section").style.height = videoElement.duration * videoPlayBack + "px";
    });

    // console.log로 적당한 위치를 찾아서 넣음
    const fixedDescriptionAppearTiming = 3470;
    const fixedDescriptionAppearEnds = 3800;

    window.addEventListener("scroll", () => {
      // console.log(window.scrollY);

      if (document.getElementById("on")) {
        document.getElementById("on").removeAttribute("id");
      }
      if (window.scrollY > listStyleChangeStartY && window.scrollY < listStyleChangeEndY) {
        // scrollY에서 요소에 접근할 index 뽑기
        const targetIndex = Math.floor((window.scrollY - listStyleChangeStartY) / division);

        listItems[targetIndex].id = "on";
      }

      // 🎯🎯 스크롤위치 + 현재뷰높이로 현재 화면에서 전체적인 위치를 계산하는 코드
      const scrollYBottom = window.scrollY + document.documentElement.clientHeight;

      // offsetTop: 해당 요소의 Y축 위치 값(전체문서 기준)
      // offsetHeight: 해당 요소의 높이 값
      // 🎯🎯
      // 현재스크롤하단위치 > panel1Img의Y위치 && 현재스크롤하단위치 < panel1Img의Y위치 + panel1Img의높이
      //  -> 스크롤이 panel1Img에 진입하거나, 스크롤이 panel1Img요소를 넘어가기 전까지
      if (scrollYBottom > panel1Img.offsetTop && scrollYBottom < panel1Img.offsetTop + panel1Img.offsetHeight) {
        // CSS에서 초기에 translate한 값(80px, -13px, 23deg)을 원래대로 돌린다는 느낌으로 동작
        // 🎯원래대로 == translate가 적용안된 0 상태
        // 🎯1.3은 원래 위치인 1.0보다 0.3 즉 30 퍼센트 더 이동하라는 뜻
        const translateX = 80 - (80 * 1.3 * (scrollYBottom - panel1Img.offsetTop)) / panel1Img.offsetHeight;
        const translateY = -13 + (13 * (scrollYBottom - panel1Img.offsetTop)) / panel1Img.offsetHeight;

        const rotationDegree = 23 - (23 * 1.7 * (scrollYBottom - panel1Img.offsetTop)) / panel1Img.offsetHeight;

        flyingSantaImage.style.transform = `translate(${translateX}px, ${translateY}px) rotate(${rotationDegree}deg)`;
      }

      centerElement("fixed-wrapper", videoElement);

      // centerElement의 화면 중앙을 탐지하는 로직처럼 화면 중앙이 videoSection의 끝에 도달하는지 확인
      // 자연스럽게 애니메이션 해제
      if (
        window.scrollY >
        videoSection.offsetTop + videoSection.offsetHeight - (fixedWrapper.offsetHeight + (document.documentElement.clientHeight - fixedWrapper.offsetHeight) / 2)
      ) {
        fixedWrapper.style.position = "relative";
        fixedWrapper.style.top = "initial";
        fixedWrapper.style.left = "initial";
        fixedWrapper.style.transform = "initial";
        fixedWrapper.style.transform = `translateY(${videoSection.offsetHeight - fixedWrapper.offsetHeight}px)`;
      }

      // fixedDescriptionAppearTiming과 fixedDescriptionAppearEnds 사이일때 실행되는 로직
      // 요소를 서서히 올리면서
      if (window.scrollY > fixedDescriptionAppearTiming && window.scrollY < fixedDescriptionAppearEnds) {
        fixedDescription.style.transform = `translateY(${fixedDescriptionAppearEnds - window.scrollY}px)`;

        // 숫자가 작을수록 서서히 변화
        fixedDescription.style.opacity = (window.scrollY - fixedDescriptionAppearTiming) / 300;
        // 글자가 나타나는 이벤트가 끝났을때 적용(fixedDescriptionAppearEnds보다 현재 위치가 더 클때)
      } else if (window.scrollY > fixedDescriptionAppearEnds) {
        fixedDescription.style.transform = `translateY(0px)`;
        fixedDescription.style.opacity = 1;
        // 그 외에는 기본적으로 투명하게 유지
      } else {
        fixedDescription.style.transform = `translateY(100px)`;
        fixedDescription.style.opacity = 0;
      }
    });
  </script>
</html>
